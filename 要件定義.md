あなたはシニアフルスタックエンジニアです。以下の仕様でアプリを実装してください。曖昧な点は合理的に決めて、TODO コメントで残しつつ進めてください。コードは TypeScript で、可読性を最優先します。英語と日本語に対応してください。

# ゴール

「目標を月単位で運用しつつ、年単位目標にも対応できる」TODO アプリを実装する。
無料/有料差分は AI 機能のみ。AI 以外の UI/通知/進捗ロジックは共通。

# 技術

- Expo (React Native) + TypeScript
- supabase-js
- Supabase (Postgres + RLS)
- 認証: Supabase Auth（Email/Password で OK）
- 画面: Expo Router を使用
- 状態管理: 最小（React Query など使ってもよいが依存は増やしすぎない）

# DB（既に SQL で作成済み想定）

テーブル:

- goals(id, user_id, title, description, category, priority, period_type(month|year|custom), start_date, end_date, status, current_plan_id, created_at, updated_at)
- plans(id, goal_id, version, source(manual|ai_split|ai_replan), created_by(user|system), reason, ai_run_id, created_at)
- tasks(id, plan_id, title, description, priority, due_date, estimated_days, order_index, status(todo|doing|done|dropped), done_at, created_at, updated_at)
- task_events(id, task_id, type(created|updated|completed|reopened|dropped), meta, created_at)
- progress_snapshots(id, goal_id, snapshot_date, total_tasks, done_tasks, actual_rate, ideal_rate, gap_rate, created_at)
- notifications(id, user_id, goal_id, type, title, body, delivered_at, opened_at, action)
- ai_runs(id, user_id, goal_id, type(split|replan|year_report), prompt_version, model, input, output, status, error_message, created_at)
- subscriptions(id, user_id unique, provider(appstore|play|stripe), status(active|trialing|canceled|expired), current_period_end, updated_at)

RPC（Postgres Function）:

- create_goal_with_initial_plan(...)
- toggle_task_done(task_id, done)
- upsert_goal_snapshot(goal_id, date)

# 進捗ロジック（共通）

理想進捗率 = 経過日数 / 期間日数
実進捗率 = done_tasks / total_tasks
乖離率 = 実 - 理想
ステータス:

- OK: gap >= -0.10
- 注意: -0.25 < gap < -0.10
- 危険: gap <= -0.25

# 画面（MVP）

タブ:

1. Home（ダッシュボード）

- 目標カード一覧（達成率・乖離ステータス表示）
- 今日やること（due_date 近いタスク上位 3）
- 「計画を見直す」導線（AI は有料ロック）

2. Goals（目標一覧）

- 目標作成へ

3. Review（週/月）

- 今週完了数、詰まり理由（選択式で保存: goals とは別にローカルでも可。余裕あれば table 追加）

4. Settings

- サインアウト
- 有料状態表示（subscriptions 参照。ここはモックでも可）

目標詳細:

- 現行 plan(current_plan_id)のタスク一覧
- タスク完了トグル（RPC toggle_task_done 使用）
- 達成率バー・乖離ステータス
- 「AI で分割」「AI で立て直し」ボタン（ロック UI を実装。押したら課金導線または説明画面へ）

# 月ベース + 年対応

- UI の基本ビューは「当月」(date_trunc month)で表示する
- goal.period_type='year' の場合も同じ画面で表示可能にし、フィルタ・集計対象期間を start/end で切り替えるだけにする

# 通知

- 送信自体はサーバ側（Edge + Cron）で行う想定だが、まずアプリ内に「通知履歴」を表示できるようにする（notifications table）
- アプリ起動時に「今日のスナップショットがなければ upsert_goal_snapshot を呼ぶ」処理を入れる（全 active 目標）

# AI（今回はモックでよい）

- 有料機能だが、まずは AI 呼び出し部分はダミー関数で OK
- 後で OpenAI 等に差し替え可能な抽象化（aiClient）を作る
- ai_runs への保存インターフェイスだけ用意しておく

# 実装手順

1. Expo プロジェクト作成、Expo Router 導入、基本ナビ構築
2. Supabase クライアント（環境変数）設定
3. Auth（ログイン/新規登録/サインアウト）
4. goals 一覧/作成（RPC create_goal_with_initial_plan 使用）
5. 目標詳細: 現行 plan タスク CRUD、完了トグル（RPC toggle_task_done）
6. ダッシュボード: 達成率/乖離表示（必要なら progress_snapshots を参照、なければ RPC で生成）
7. notifications 履歴画面（簡易）
8. 有料ロック UI（subscriptions 参照。無ければ無料扱い）

# コーディング規約

- すべて TypeScript
- 関数・コンポーネントは小さく
- supabase アクセスは repository 層に分離
- 画面は containers/components に分ける
- 主要なソースには必ずコメント、id を入れる。
- TODO コメントは必ず "TODO(#ID): ..." 形式で ID を入れる

まずはリポジトリ構造案と、主要画面のルーティング、Supabase 接続/認証まで実装してください。
